<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Memproteksi File EXE Dengan Password - Grup KPPDI</title><meta name="description" content="Software : Delphi 6, PE Inject API oleh Michal Strahovsky Tingkat Kemahiran: 80% Kategori: Sekuriti &amp; WIN32API Pengantar Banyak kita melihat virus-virus yang menyerang file EXE/PE, seperti varian Alman, Virut dan berbagai virus lainnya. Banyak juga yang membuat aplikasi-aplikasi untuk memproteksi komputer dari tangan jahil&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://kppdi.github.io/memproteksi-file-exe-dengan-password/"><link rel="alternate" type="application/atom+xml" href="https://kppdi.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://kppdi.github.io/feed.json"><meta property="og:title" content="Memproteksi File EXE Dengan Password"><meta property="og:image" content="https://kppdi.github.io/media/posts/32/laptop-2557586_1280.jpg"><meta property="og:site_name" content="Grup KPPDI"><meta property="og:description" content="Software : Delphi 6, PE Inject API oleh Michal Strahovsky Tingkat Kemahiran: 80% Kategori: Sekuriti &amp; WIN32API Pengantar Banyak kita melihat virus-virus yang menyerang file EXE/PE, seperti varian Alman, Virut dan berbagai virus lainnya. Banyak juga yang membuat aplikasi-aplikasi untuk memproteksi komputer dari tangan jahil&hellip;"><meta property="og:url" content="https://kppdi.github.io/memproteksi-file-exe-dengan-password/"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://kppdi.github.io/media/website/favicon-kppdi.png" type="image/png"><style>:root {
                --body-font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
                --heading-font: var(--body-font);
                --post-entry-font: var(--body-font);
                --logo-font: var(--body-font);
                --menu-font: var(--body-font)
            }</style><link rel="stylesheet" href="https://kppdi.github.io/assets/css/style.css?v=2da59a98f57654266b2edb505b983e39"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://kppdi.github.io/memproteksi-file-exe-dengan-password/"},"headline":"Memproteksi File EXE Dengan Password","datePublished":"2008-05-13T16:41","dateModified":"2020-08-01T19:15","image":{"@type":"ImageObject","url":"https://kppdi.github.io/media/posts/32/laptop-2557586_1280.jpg","height":853,"width":1280},"description":"Software : Delphi 6, PE Inject API oleh Michal Strahovsky Tingkat Kemahiran: 80% Kategori: Sekuriti &amp; WIN32API Pengantar Banyak kita melihat virus-virus yang menyerang file EXE/PE, seperti varian Alman, Virut dan berbagai virus lainnya. Banyak juga yang membuat aplikasi-aplikasi untuk memproteksi komputer dari tangan jahil&hellip;","author":{"@type":"Person","name":"Grup KPPDI"},"publisher":{"@type":"Organization","name":"Grup KPPDI","logo":{"@type":"ImageObject","url":"https://kppdi.github.io/media/website/kppdi-headd.png","height":72,"width":322}}}</script></head><body><header class="topbar" id="js-header"><div class="topbar__inner"><a class="logo" href="https://kppdi.github.io/"><img src="https://kppdi.github.io/media/website/kppdi-headd.png" alt="Grup KPPDI"></a><nav class="navbar"><button class="navbar__toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://kppdi.github.io/" target="_self">Home</a></li><li><a href="https://kppdi.github.io/tags/docs/" target="_self">Docs</a></li><li><a href="https://kppdi.github.io/tags/tutorials/" target="_self">Tutorial</a></li><li><a href="https://kppdi.github.io/tags/sample-apps/" target="_self">Sample App</a></li><li><a href="https://kppdi.github.io/tags/files/" target="_self">Files</a></li></ul></nav></div></header><div class="content"><div class="infobar"><div class="infobar__update">Last Updated: <time datetime="2020-08-02T19:39">2 August 2020</time></div><div class="infobar__search"><form action="https://kppdi.github.io/search.html"><input type="search" name="q" placeholder=" search..."> <button type="submit" aria-label="Search"><svg width="15px" height="14px"><use xlink:href="https://kppdi.github.io/assets/svg/svg-map.svg#search"/></svg></button></form></div></div><main class="main"><article class="post"><figure class="post__featured-image"><img src="https://kppdi.github.io/media/posts/32/laptop-2557586_1280.jpg" srcset="https://kppdi.github.io/media/posts/32/responsive/laptop-2557586_1280-xs.jpg 300w, https://kppdi.github.io/media/posts/32/responsive/laptop-2557586_1280-sm.jpg 480w, https://kppdi.github.io/media/posts/32/responsive/laptop-2557586_1280-md.jpg 768w, https://kppdi.github.io/media/posts/32/responsive/laptop-2557586_1280-lg.jpg 1024w, https://kppdi.github.io/media/posts/32/responsive/laptop-2557586_1280-xl.jpg 1360w, https://kppdi.github.io/media/posts/32/responsive/laptop-2557586_1280-2xl.jpg 1600w" sizes="(max-width: 1600px) 100vw, 1600px" loading="eager" height="853" width="1280" alt=""></figure><header class="u-header post__header"><h1>Memproteksi File EXE Dengan Password</h1><div class="u-header__meta u-small"><img src="https://kppdi.github.io/media/website/Logo-KPPDI.png" loading="eager" class="u-header__avatar" alt="Grup KPPDI"><div><a href="https://kppdi.github.io/authors/grup-kppdi/" title="Grup KPPDI">Grup KPPDI</a> <time datetime="2008-05-13T16:41">13 May 2008 </time><a href="https://kppdi.github.io/tags/delphi/" class="u-tag u-tag--1">Delphi</a></div></div></header><div class="post__entry u-inner"><p>Software : Delphi 6, PE Inject API oleh <a href="http://migeel.sk" target="_blank" rel="noopener">Michal Strahovsky</a><br>Tingkat Kemahiran: 80%<br>Kategori: Sekuriti &amp; WIN32API</p><p><strong>Pengantar</strong></p><p>Banyak kita melihat virus-virus yang menyerang file EXE/PE, seperti varian Alman, Virut dan berbagai virus lainnya. Banyak juga yang membuat aplikasi-aplikasi untuk memproteksi komputer dari tangan jahil atau bahkan virus. Pertanyaan, jika kedua jenis software di atas bisa kita buat, yang mana yang akan kita buat?<br>Saya pribadi akan membuat virus. Sayang, saya tidak bisa membuat virus yang bauk, jadi "terpaksa" saya pilih yang kedua, aplikasi untuk kepentingan sekuriti.</p><p>Virus-virus yang menyerang file PE/EXE, sebagaimana juga software sekuriti dimaksud di atas, setidaknya memiliki dua opsi untuk mengerjakan tugasnya - menurut sepengetahuan saya, harap diingat - itu. Seperti ini:</p><ol><li>Sebagai stub dengan embbeded data. Ini mirip dengan aplikasi installer pada umumnya, di mana sebuah aplikasi membuat/mengkopi file EXE/PE dan kemudian menambahkan data tambahan di akhirnya, dan di bagian paling akhir (atau di bagian mana saja yang aman), ditambahkan beberapa parameter untuk digunakan oleh stub nantinya, seperti CRC check signature, besar data yang diembed, jumlah file/data yang diembed, dsb. Jika, misalnya, cara ini dipakai untuk kepentingan distribusi data melalui sebuah file (Self Extractor) atau SFX, jadilah dia sebuah aplikasi instalasi. Namun jika dipakai untuk menyebarkan "sesuatu", maka jadilah dia dalam golongan virus. Sebagai catatan, jika ada yang membuat virus dengan cara ini, sebaiknya kedua tugas di atas - membuat stub dan mengandung embedded data - dikerjakan oleh sebuah EXE saja, sehingga bisa menyebar tanpa software bantu lainnya. Dan sebaiknya jangan memilih tool yang menggunakan shared depencies seperti VB :-)<br>Di Tanah Air Indonesia ini, saya melihat kecenderungan membuat trojan atau virus - atau apa kek- dengan metode ini. Namun ada kelemahannya, icon aplikasi (stub/target) yang sudah dihinggapi (bukan diinfeksi) akan berubah sesuai icon stub yang sebenarnya, jadi user yang menjadi korban, jika cukup teliti, akan tahu bahwa dia sedang disantet.<br>Ini sebanya (barangkali), beberapa waktu lalu saya acap menerima e-mail atau membaca posting di milis-milis tentang bagaimana mengubah icon sebuah aplikasi. Tapi sebagaimana Anda, saya juga tidak menjawab sebuah pertanyaan yang mempunyai tendensi negatif, apalagi yang ditanyakan oleh seorang Delphier. Bukankah akan memalukan?</li><li>Ini yang seru. Sebagai stub yang menjadi bagian dari file yang ditumpangi. Varian Alman dan Virut di atas masuk kategori ini. Sebuah aplikasi, katakan A, akan menyuntik kode-kode tertentu, katakan B, (seperti DLL Injection) yang residen dalam file target. Jika cara ini dipakai oleh virus, maka virus itu akan masuk kategori sulit dibasmi, kecuali dengan mempertaruhkan keselamatan file terinfeksi (bukan dihinggapi, silahkan bandingkan dengan metode pertama di atas) :-)<br>Seperti juga di atas, jika sebuah program mampu menjadi kode yang iinject sekaligus penginjectnya, pastikan program ini sudah menjadi sebuah virus yang tangguh. Tinggal ditambahkan sebuah rutin untuk mencari file PE/EXE di harddisk target, trus jalankan injeksi ke tiap PE/EXE yang mungkin untuk diinject.</li></ol><p>Baik. Sampai di sini, saya menunggu koreksi jika Anda menemukan ketidak sesuaian.</p><p>Sesuai judul, kita hanya akan membahas metode nomor dua, dengan batasan positif, membuat sebuah aplikasi sekuriti untuk memproteksi file-file PE/EXE dengan password. Berikut kita lihat beberapa gambar screenshot dari demo aplikasi yang sudah saya buat:</p><figure class="alignnone size-medium wp-image-149"><a href="http://jokorb.files.wordpress.com/2008/05/d8989du09sdf9df_pe_lock_01.gif"><img loading="lazy" src="https://kppdi.github.io/media/posts/32/d8989du09sdf9df_pe_lock_01.gif" alt="" width="300" height="193"></a></figure><br>Ini tampilan depan.<p></p><figure class="alignnone size-medium wp-image-150"><a href="http://jokorb.files.wordpress.com/2008/05/diidfdu09sd567yf9df_pe_lock_02.jpg"><img loading="lazy" src="https://kppdi.github.io/media/posts/32/diidfdu09sd567yf9df_pe_lock_02.jpg" sizes="(max-width: 48em) 100vw, 768px" srcset="https://kppdi.github.io/media/posts/32/responsive/diidfdu09sd567yf9df_pe_lock_02-xs.jpg 300w, https://kppdi.github.io/media/posts/32/responsive/diidfdu09sd567yf9df_pe_lock_02-sm.jpg 480w, https://kppdi.github.io/media/posts/32/responsive/diidfdu09sd567yf9df_pe_lock_02-md.jpg 768w, https://kppdi.github.io/media/posts/32/responsive/diidfdu09sd567yf9df_pe_lock_02-lg.jpg 1024w, https://kppdi.github.io/media/posts/32/responsive/diidfdu09sd567yf9df_pe_lock_02-xl.jpg 1360w, https://kppdi.github.io/media/posts/32/responsive/diidfdu09sd567yf9df_pe_lock_02-2xl.jpg 1600w" alt="" width="216" height="125"></a></figure><br>Ini tampilan pesan yang menyatakan bahwa proses injeksi berlangsung sempurna.<p></p><figure class="alignnone size-medium wp-image-151"><a href="http://jokorb.files.wordpress.com/2008/05/e8ffgbdiidfdu09sd567yf9df_pe_lock_03.jpg"><img loading="lazy" src="https://kppdi.github.io/media/posts/32/e8ffgbdiidfdu09sd567yf9df_pe_lock_03.jpg" sizes="(max-width: 48em) 100vw, 768px" srcset="https://kppdi.github.io/media/posts/32/responsive/e8ffgbdiidfdu09sd567yf9df_pe_lock_03-xs.jpg 300w, https://kppdi.github.io/media/posts/32/responsive/e8ffgbdiidfdu09sd567yf9df_pe_lock_03-sm.jpg 480w, https://kppdi.github.io/media/posts/32/responsive/e8ffgbdiidfdu09sd567yf9df_pe_lock_03-md.jpg 768w, https://kppdi.github.io/media/posts/32/responsive/e8ffgbdiidfdu09sd567yf9df_pe_lock_03-lg.jpg 1024w, https://kppdi.github.io/media/posts/32/responsive/e8ffgbdiidfdu09sd567yf9df_pe_lock_03-xl.jpg 1360w, https://kppdi.github.io/media/posts/32/responsive/e8ffgbdiidfdu09sd567yf9df_pe_lock_03-2xl.jpg 1600w" alt="" width="245" height="59"></a></figure><br>Ini tampilan jika PE/EXE yang telah dinjeksi dijalankan :-)<p></p><p><strong>Proses Pembuatan</strong></p><p>Proses pembuatan aplikasi proteksi ini kita bagi dua. Yang pertama kode yang akan diinject ke file target (yang harus merupakan PE/EXE), dan yang kedua aplikasi untuk menginjeksi. Kita tidak membuat virus, jadi tugas aplikasi ini kita pisahkan, tidak dilakukan oleh sebuah aplikasi tunggal.</p><p>Untuk menjalankan proses, kita butuh PE Inject Library oleh <a href="http://migeel.sk" target="_blank" rel="noopener">Michal Strahovsky</a>, yang mana bukan saya pembuatnya :-). Silahkan download di websitenya <a href="http://migeel.sk" target="_blank" rel="noopener">http://migeel.sk</a>. Selanjutnya , kita buat sebuah projek baru di Delphi (saya menggunakan Delphi 6), dengan target Dynamic Link Library. Ini untuk mempermudah, karena <a href="http://migeel.sk" target="_blank" rel="noopener">Michal Strahovsky</a> memilih menggunakan DLL sebagai kode yang akan diinject, sehingga dengan mudah kita buat, tanpa harus pusing menentukan batasan-batasan kode yang akan kita inject. Plus, kita bisa sertakan form (dengan WinAPI) tentunya.</p><p><a href="http://migeel.sk" target="_blank" rel="noopener">Michal Strahovsky</a> membagi kode dalam DLL kita atas dua, berupa fungsi BeforeHandler dan AfterHandler, yang akan dijalankan sebelum kode PE/EXE sesungguhnya dari file target, kemudian masuk ke entry point PE/EXE target, dan setelah berakhir, outpoint akan melompat ke awal fungsi AfterHandler dan menjalankan kode kita. Agar bisa diload oleh PEInject, kedua fungsi ini harus diekspor.</p><p>Saya tidak menggunakan AfterHandler (opsional) karena yang saya butuhkan hanya Beforehandler sebelum masuk entry point PE/EXE target - yang disebut Original Entry Point, selanjutnya akan saya sebut OEP saja. Kemudian saya tambahkan sebuah fungsi WindowPorc untuk memproses pesan. Funsgi ini perlu untuk menangani message yang datanng dari Windows. Ingat, untuk meminta password kita butuh form dan minimal sebuah EditBox. Untuk membuat form, kita butuh WindowProc.</p><p>Perbedaan mendasar DLL ini dari DLL lainnya adalah, entry pointnya berada pada fungsi BeforeHandler, bukan Begin &amp; End. Jadi proses pembuatan form harus ditempatkan dalam fungsi ini.</p><p>Agar tidak membosankan, saya langsung saja dengan kodenya, yang terbagi atas dua: Entry Point BeforeHandler dan WindowProc.</p><p>[sourcecode language='delphi']<br>Library pelock;</p><p>uses<br>Windows,Messages, InjectionTypes;</p><p>const<br>ClassName='PELOCKER_Plugin';</p><p>var<br>sLen:cardinal;<br>form1,<br>lblPassword,<br>edtPassword,<br>BtnOK:hwnd;<br>s, pass:string;<br>wc:TWNDClassEx;<br>msg:Tmsg;<br>Font:HFont;<br>p:PChar;<br>Adata:PextData;</p><p>truePass:Boolean;</p><p>//define window proc:<br>function WndProc(handle:hwnd; wmsg:cardinal;wparam:WParam;lparam:LParam):longint;stdcall;<br>begin<br>result:=defWindowProc(handle,wmsg,wparam,lparam);<br>case wmsg of<br>wm_Destroy:<br>begin<br>halt;<br>end;<br>wm_command:<br>begin<br>if lparam=BtnOK then //user click send button:<br>begin<br>slen:=GetWindowTextLength(edtPassword);<br>if slen=0 then begin //no message, boom!<br>Messagebox(handle,'There is no password entered.','Cannot Run',MB_ICONHAND);<br>SetWindowText(edtPassword, nil);<br>SetFocus(edtPassword);<br>end<br>else<br>begin<br>//is it true password?<br>Pass:=Adata^.Password;<br>//DEBUG_ONLY:-&gt; MessageBox(Form1, PChar(pass), 'Test',MB_OK);<br>getmem(p, slen+1);<br>GetWindowText(edtPassword, p, slen+1);<br>s:=String(p);<br>FreeMem(p);<br>if s=pass then<br>begin<br>truePass:=True;<br>end<br>else<br>begin<br>MessageBox(Form1, 'Invalid password!','Cannot Run',MB_ICONHAND);<br>SetWindowText(edtPassword, nil);<br>SetFocus(edtPassword);<br>end;<br>end;<br>end;<br>end;<br>//case...<br>{<br>other message<br>}<br>end;<br>end;</p><p>function BeforeHandlers(Config: PStubConfiguration): DWORD; stdcall;<br>begin<br>Adata:=PExtData(Config.ImageBase+Config.ExtraDataRVA);<br>truepass:=False;</p><p>//define main window's class:<br>wc.cbSize:=sizeof(wc);<br>wc.style:=0;<br>wc.lpfnWndProc:=@WndProc;<br>wc.cbClsExtra:=0;<br>wc.cbWndExtra:=0;<br>wc.hInstance:=Hinstance;<br>wc.hIcon:=LoadIcon(hinstance,'MAINICON');<br>wc.hCursor:=LoadCursor(hinstance,IDC_ARROW);<br>wc.hbrBackground:=color_btnface+1;<br>wc.lpszMenuName:=nil;<br>wc.lpszClassName:=ClassName;<br>wc.hIconSm:=0;<br>//register class:<br>registerclassex(wc);<br>//Create main window:<br>form1:=CreateWindowEx(WS_EX_STATICEDGE,<br>pchar(ClassName),'PE Lock - JokoRB',<br>WS_DLGFRAME+WS_VISIBLE+WS_SYSMENU,<br>253,191,245,60,<br>0,0,<br>hinstance,nil);<br>//show it<br>ShowWindow(form1,SW_SHOW);<br>updateWindow(form1);<br>lblPassword:=CreateWindow(<br>'Static','Password',WS_VISIBLE+WS_CHILD,<br>2<br>,6,<br>50,<br>13,<br>form1,<br>0,<br>hinstance,nil);</p><p>edtPassword:=CreateWindow(<br>'Edit',<br>nil,<br>WS_VISIBLE+WS_CHILD+WS_BORDER+ES_AUTOHSCROLL+ES_PASSWORD,<br>63,<br>2,<br>121,<br>21,<br>form1,0,hinstance,nil);</p><p>BtnOK:=CreateWindow('Button',<br>'Run!',<br>WS_CHILD+WS_VISIBLE+BS_PUSHLIKE,<br>187,<br>2,<br>46,<br>21,<br>form1,<br>0,hinstance,nil);<br>//Create Default font:<br>font:=CreateFont(14,5,0,0,0,0,0,0,0,0,0,0,0,'Arial');<br>//set Control's font:<br>SendMessage(lblPassword,WM_SETFONT,font,0);<br>SendMessage(edtPassword,WM_SETFONT,font,0);<br>SendMessage(BtnOK,WM_SETFONT,font,0);<br>//limit entry text for hostname and message to 200 character<br>SendMessage(edtPassword,EM_LIMITTEXT,30,0);<br>SetFocus(edtPassword);<br>//Then Create Message Processing Looping:<br>while getmessage(msg,0,0,0) do<br>begin<br>TranslateMessage(msg);<br>DispatchMessage(msg);<br>if truepass then<br>begin<br>ShowWindow(Form1, SW_HIDE);<br>exit;<br>end;<br>end;</p><p>Result:=1; // the result is not checked, so this could be anything<br>end;</p><p>exports BeforeHandlers;<br>begin<br>end.</p><p>[/sourcecode]</p><p>OK. Kita lanjut ke program penginjeknya.</p><p>Kita butuh sebuah resource yang berisi DLL di atas. Ini supaya DLL nantinya tidak perlu diload dari harddisk.<br>Jadi kita buat sebuah file Resource Script dan isikann dengan skrip berikut</p><p>[sourcecode language='delphi']<br>lockplugin RCDATA pelock.dll<br>[/sourcecode]</p><p>Script ini bisa dikompilasi dengan BRCC32 - terdapat dalam %DelphiFolder%\Bin - untuk mendapatkan file Compiled Resource-nya. Ingat, pelock.dll adalah hasil kompilasi kode DLL di atas. Selanjutnya kita buat sebuah projek baru lagi dan tambahkan resource hasil kompilasi skrip di atas ke project source atau ke unit1 (unit utama).</p><p>[sourcecode language='delphi']<br>//......................</p><p>PE_LOCK_DLL = 'pelocklugin.dll';</p><p>var<br>Form1: TForm1;</p><p>implementation</p><p>{$R *.dfm}</p><p>//tambahkan baris berikut, dengan memisalkan nama file resource adalah<br>// plugin.res</p><p>{$R plugin.RES}<br>//..........................................<br>[/sourcecode]</p><p>Kemudian, kita lihat prosedur untuk melakukan proses injeksi:<br>[sourcecode language='delphi']<br>procedure TForm1.SpeedButton2Click(Sender: TObject);<br>var<br>cback:Boolean;<br>ExtData:PExtData;<br>PHost, PDll:Pointer;<br>szHost, szDll:Cardinal;<br>mslSize:DWORD;<br>msldata, PEData:Pointer;<br>TestSize:DWORD;<br>begin<br>cback:=CheckBox1.Checked;<br>if not FileExists(edit1.Text) then<br>begin<br>MessageBox(handle, 'File doesn''t exist!', 'Error',MB_ICONHAND);<br>Edit1.SetFocus;<br>Edit1.SelectAll;<br>exit;<br>end;<br>if Edit2.Text&lt;&gt;Edit3.Text then<br>begin<br>MessageBox(handle, 'Passwords don''t match!', 'Error',MB_ICONHAND);<br>Edit2.SetFocus;<br>Edit2.SelectAll;<br>exit;<br>end;</p><p>if Edit2.Text='' then<br>begin<br>MessageBox(handle, 'Passwords are empty!', 'Error',MB_ICONHAND);<br>Edit2.SetFocus;<br>Edit2.SelectAll;<br>exit;<br>end;</p><p>TestSize:=TakeFileSize(Edit1.Text);<br>if testsize &gt; (100*1024*1024) {100MB} then<br>begin<br>MessageBox(handle, 'Target PE''size exceeds limit (100MB)!', 'Error',MB_ICONHAND);<br>Edit1.SetFocus;<br>Edit1.SelectAll;<br>exit;<br>end;</p><p>with TMemoryStream.Create() do<br>begin<br>LoadFromFile(Edit1.Text);<br>szHost:=size;<br>GetMem(PHost, szHost);<br>Read(pHost^, szHost);<br>Free;<br>end;</p><p>with TResourceStream.Create(hInstance, 'lockplugin', RT_RCDATA) do<br>begin<br>szDll:=Size;</p><p>GetMem(pDll, szDll);<br>Read(pDll^, szDll);<br>Free;<br>end;</p><p>//get dll as MSL:<br>mslSize:=szDLL;<br>mslData:=MappedDllToMsl(pDLL, @mslSize);<br>FreeMem(pdll);</p><p>New(ExtData);<br>ExtData^.PasswordLength:=Length(Edit2.Text);<br>ExtData^.Password:=Edit2.Text;</p><p>if CBack then<br>CopyFile(PChar(edit1.text), Pchar(Edit1.Text+'.bak'), False);</p><p>PEData:=injectMappedFile(PHost, @szHost, MSLDATA, MslSize, ExtData, sizeof(TExtData),<br>INJECT_FLAG_DOIMPORTS or<br>INJECT_FLAG_JUMPTOOEP or<br>INJECT_FLAG_HANDLERELOC or<br>INJECT_FLAG_STRIPRELOCS or<br>INJECT_FLAG_COMPRESSDLL or<br>INJECT_FLAG_BACKUPTLS<br>);<br>if PEData&lt;&gt;nil<br>{<br>if 0 = InjectFile(Pchar(edit1.text),<br>Pchar(edit1.text),<br>PChar(fn),<br>ExtData,<br>SizeOf(TextData),<br>INJECT_FLAG_DOIMPORTS or<br>INJECT_FLAG_JUMPTOOEP or<br>INJECT_FLAG_HANDLERELOC or<br>INJECT_FLAG_STRIPRELOCS or<br>INJECT_FLAG_COMPRESSDLL or<br>INJECT_FLAG_BACKUPTLS<br>)<br>}<br>then<br>begin<br>SaveFile(PEData, szHost, Edit1.Text);<br>FreeMem(PHost, szHost);<br>FreeMem(MSLDATA, mslSize);<br>FreeMem(peData);<br>MessageBox(handle, 'PE was injected successfully.', 'Information',MB_ICONInformation);<br>end<br>else<br>begin<br>MessageBox(handle, 'PE Injection failed.', 'Error',MB_ICONHAND);<br>end;<br>DispoSe(extData);<br>end;<br>[/sourcecode]</p><p>Sampai di situ. Beberapa fungsi pendukung seperti TakeFileSize dan System dir tidak perlu saya tulis. Yang pertama untuk mengambil ukuran sebuah file dan yang kedua untuk mengambil path tempa System32 berada. Kenyataanya, kedua fungsi ini tidak dipakai :-)</p><p>Dan berikut kode selengkapnya:<br>[sourcecode language='delphi']<br>unit uMMain;</p><p>interface</p><p>uses<br>Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,<br>Dialogs, ExtCtrls, jpeg, StdCtrls, Buttons, InjectionTypes, InjectionEngine, msl, PEUtils;</p><p>type</p><p>TForm1 = class(TForm)<br>Panel1: TPanel;<br>Label1: TLabel;<br>Label2: TLabel;<br>imgOn: TImage;<br>Bevel1: TBevel;<br>Label3: TLabel;<br>Edit1: TEdit;<br>SpeedButton1: TSpeedButton;<br>OpenDialog1: TOpenDialog;<br>Bevel2: TBevel;<br>Label4: TLabel;<br>Label5: TLabel;<br>Edit2: TEdit;<br>Label6: TLabel;<br>Edit3: TEdit;<br>CheckBox1: TCheckBox;<br>Bevel3: TBevel;<br>SpeedButton2: TSpeedButton;<br>SpeedButton3: TSpeedButton;<br>Label7: TLabel;<br>procedure SpeedButton1Click(Sender: TObject);<br>procedure SpeedButton2Click(Sender: TObject);<br>procedure SpeedButton3Click(Sender: TObject);<br>private<br>{ Private declarations }<br>public<br>{ Public declarations }<br>function TakeFileSize(const AFile:String):DWORD;<br>function SystemDir:String;<br>end;</p><p>const<br>PE_LOCK_DLL = 'pelocklugin.dll';</p><p>var<br>Form1: TForm1;</p><p>implementation</p><p>{$R *.dfm}<br>{$R plugin.RES}</p><p>procedure TForm1.SpeedButton1Click(Sender: TObject);<br>begin<br>if OpenDIalog1.Execute then<br>begin<br>edit1.Text:=openDialog1.FileName;<br>end;<br>end;</p><p>procedure TForm1.SpeedButton2Click(Sender: TObject);<br>var<br>cback:Boolean;<br>ExtData:PExtData;<br>PHost, PDll:Pointer;<br>szHost, szDll:Cardinal;<br>mslSize:DWORD;<br>msldata, PEData:Pointer;<br>TestSize:DWORD;<br>begin<br>cback:=CheckBox1.Checked;<br>if not FileExists(edit1.Text) then<br>begin<br>MessageBox(handle, 'File doesn''t exist!', 'Error',MB_ICONHAND);<br>Edit1.SetFocus;<br>Edit1.SelectAll;<br>exit;<br>end;<br>if Edit2.Text&lt;&gt;Edit3.Text then<br>begin<br>MessageBox(handle, 'Passwords don''t match!', 'Error',MB_ICONHAND);<br>Edit2.SetFocus;<br>Edit2.SelectAll;<br>exit;<br>end;</p><p>if Edit2.Text='' then<br>begin<br>MessageBox(handle, 'Passwords are empty!', 'Error',MB_ICONHAND);<br>Edit2.SetFocus;<br>Edit2.SelectAll;<br>exit;<br>end;</p><p>TestSize:=TakeFileSize(Edit1.Text);<br>if testsize &gt; (100*1024*1024) {100MB} then<br>begin<br>MessageBox(handle, 'Target PE''size exceeds limit (100MB)!', 'Error',MB_ICONHAND);<br>Edit1.SetFocus;<br>Edit1.SelectAll;<br>exit;<br>end;</p><p>with TMemoryStream.Create() do<br>begin<br>LoadFromFile(Edit1.Text);<br>szHost:=size;<br>GetMem(PHost, szHost);<br>Read(pHost^, szHost);<br>Free;<br>end;</p><p>with TResourceStream.Create(hInstance, 'lockplugin', RT_RCDATA) do<br>begin<br>szDll:=Size;</p><p>GetMem(pDll, szDll);<br>Read(pDll^, szDll);<br>Free;<br>end;</p><p>//get dll as MSL:<br>mslSize:=szDLL;<br>mslData:=MappedDllToMsl(pDLL, @mslSize);<br>FreeMem(pdll);</p><p>New(ExtData);<br>ExtData^.PasswordLength:=Length(Edit2.Text);<br>ExtData^.Password:=Edit2.Text;</p><p>if CBack then<br>CopyFile(PChar(edit1.text), Pchar(Edit1.Text+'.bak'), False);</p><p>PEData:=injectMappedFile(PHost, @szHost, MSLDATA, MslSize, ExtData, sizeof(TExtData),<br>INJECT_FLAG_DOIMPORTS or<br>INJECT_FLAG_JUMPTOOEP or<br>INJECT_FLAG_HANDLERELOC or<br>INJECT_FLAG_STRIPRELOCS or<br>INJECT_FLAG_COMPRESSDLL or<br>INJECT_FLAG_BACKUPTLS<br>);<br>if PEData&lt;&gt;nil<br>{<br>if 0 = InjectFile(Pchar(edit1.text),<br>Pchar(edit1.text),<br>PChar(fn),<br>ExtData,<br>SizeOf(TextData),<br>INJECT_FLAG_DOIMPORTS or<br>INJECT_FLAG_JUMPTOOEP or<br>INJECT_FLAG_HANDLERELOC or<br>INJECT_FLAG_STRIPRELOCS or<br>INJECT_FLAG_COMPRESSDLL or<br>INJECT_FLAG_BACKUPTLS<br>)<br>}<br>then<br>begin<br>SaveFile(PEData, szHost, Edit1.Text);<br>FreeMem(PHost, szHost);<br>FreeMem(MSLDATA, mslSize);<br>FreeMem(peData);<br>MessageBox(handle, 'PE was injected successfully.', 'Information',MB_ICONInformation);<br>end<br>else<br>begin<br>MessageBox(handle, 'PE Injection failed.', 'Error',MB_ICONHAND);<br>end;<br>DispoSe(extData);<br>end;</p><p>function TForm1.TakeFileSize(const AFile: String): DWORD;</p><p>begin<br>With TFileStream.Create(AFile, fmOpenRead or FMShareDenyNone) do<br>begin<br>try<br>Result:=Size;<br>finally<br>Free;<br>End;<br>end;<br>end;</p><p>procedure TForm1.SpeedButton3Click(Sender: TObject);<br>begin<br>Messagebox(handle, 'PE Executable Locker by JokoRB.'#13'Find more at htt://jokorb.wordpress.com!','About',MB_ICONINFORMATION or MB_OK);<br>end;</p><p>function TForm1.SystemDir: String;<br>var<br>p:PChar;<br>begin<br>GetMem(p, MAX_PATH+1);<br>GetSystemDirectory(p, MAX_PATH);<br>Result:=String(p);<br>FreeMem(p, MAX_PATH+1);<br>if Result[Length(Result)]='\' then<br>Delete(Result, Length(Result),1);<br>end;</p><p>end.</p><p>[/sourcecode]</p><p>Saya tidak sempat menulis banyak, apalagi tentang proses injeksi yang sesungguhnya. Tapi bila Anda tertarik, silahkan komen saja ke sini. Untuk ketarangan lebih jauh, silahkan kunjungi <a href="http://migeel.sk" target="_blank" rel="noopener">http://migeel.sk</a> dan <a href="http://www.pelib.com" target="_blank" rel="noopener">www.pelib.com</a>.</p><p><strong>Download</strong></p><p>Berikut demo dari posting ini beserta source kodenya dan PEInject Library:<br><a href="http://jokorb.files.wordpress.com/2008/05/nswy7uhvd3fvd453_pelocker.ppt">Demo + Source</a><br><a href="http://migeel.sk/programming/pe-inject/" target="_blank" rel="noopener">PE Inject Library<br></a>Dan jangan lupa, ekstensi ppt harus diubah ke zip, dan scan dulu file hasil download dengan antivirus :-)</p><pre>google_tags: delphi, Exe/PE, EXE/PE Protector, EXE/PE Password, PE Inject, PE-Inject,
PeInject, Michal Stehovsky, migeel.sk, www.pelib.com, jokorb.wordpress.com</pre></div><aside class="post__aside"><div class="post__last-updated u-small">This article was updated on 1 August 2020</div><div class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fkppdi.github.io%2Fmemproteksi-file-exe-dengan-password%2F" class="js-share facebook" title="Share with Facebook" rel="nofollow noopener noreferrer" aria-label="Share with Facebook"><svg class="u-icon"><use xlink:href="https://kppdi.github.io/assets/svg/svg-map.svg#facebook"/></svg> </a><a href="https://pinterest.com/pin/create/button/?url=https%3A%2F%2Fkppdi.github.io%2Fmemproteksi-file-exe-dengan-password%2F&amp;media=https%3A%2F%2Fkppdi.github.io%2Fmedia%2Fposts%2F32%2Flaptop-2557586_1280.jpg&amp;description=Memproteksi%20File%20EXE%20Dengan%20Password" class="js-share pinterest" title="Share with Pinterest" rel="nofollow noopener noreferrer" aria-label="Share with Pinterest"><svg class="u-icon"><use xlink:href="https://kppdi.github.io/assets/svg/svg-map.svg#pinterest"/></svg> </a><a href="https://wa.me/?text=Memproteksi%20File%20EXE%20Dengan%20Password https%3A%2F%2Fkppdi.github.io%2Fmemproteksi-file-exe-dengan-password%2F" class="js-share whatsapp" rel="nofollow noopener noreferrer" title="Share with WhatsApp" aria-label="Share with WhatsApp"><svg class="u-icon"><use xlink:href="https://kppdi.github.io/assets/svg/svg-map.svg#whatsapp"/></svg> </a><a href="http://www.linkedin.com/shareArticle?url=https%3A%2F%2Fkppdi.github.io%2Fmemproteksi-file-exe-dengan-password%2F&amp;title=Memproteksi%20File%20EXE%20Dengan%20Password" class="js-share linkedin" title="Share with LinkedIn" rel="nofollow noopener noreferrer" aria-label="Share with LinkedIn"><svg class="u-icon"><use xlink:href="https://kppdi.github.io/assets/svg/svg-map.svg#linkedin"/></svg></a></div></aside><footer class="post__footer"><ul class="post__tag box"><li><a href="https://kppdi.github.io/tags/delphi/" class="u-tag u-tag--1" title="Delphi">Delphi</a></li><li><a href="https://kppdi.github.io/tags/injection/" class="u-tag u-tag--1" title="Injection">Injection</a></li><li><a href="https://kppdi.github.io/tags/peinject/" class="u-tag u-tag--1" title="PEInject">PEInject</a></li></ul><div class="post__bio box"><img class="u-author__avatar" src="https://kppdi.github.io/media/website/Logo-KPPDI.png" loading="lazy" alt="Grup KPPDI"><div><h4 class="h6"><a href="https://kppdi.github.io/authors/grup-kppdi/" title="Grup KPPDI">Grup KPPDI</a></h4></div></div><nav class="post__nav box"><div class="post__nav__prev"><a href="https://kppdi.github.io/install-txibutton-di-codegear-delphi-2007/" class="post__nav__link" rel="prev"><img src="https://kppdi.github.io/media/posts/31/responsive/adwords-793034_1280-xs.jpg" loading="lazy" alt=""><div class="u-small">Previous Post<h5>Install TXiButton Di Codegear Delphi 2007</h5></div></a></div><div class="post__nav__next"><a href="https://kppdi.github.io/dasar-dll-injection/" class="post__nav__link" rel="next"><div class="u-small">Next Post<h5>Dasar DLL Injection</h5></div><img src="https://kppdi.github.io/media/posts/33/responsive/geometry-2520247_1280-xs.jpg" loading="lazy" alt=""></a></div></nav><div class="post__related box"><h3 class="box__title">Related posts</h3><div class="post__related-wrap"><figure class="post__related-item"><a href="https://kppdi.github.io/lebih-jauh-dengan-pointer-2/" class="c-card__image"><img src="https://kppdi.github.io/media/posts/81/responsive/fiber-4814456_1280-xs.jpg" loading="lazy" height="853" width="1280" alt=""></a><figcaption><h4 class="post__related-title"><a href="https://kppdi.github.io/lebih-jauh-dengan-pointer-2/" class="inverse">Lebih Jauh Dengan Pointer [ 2 ]</a></h4><time datetime="2010-03-24T14:21" class="u-small">24 March 2010</time></figcaption></figure><figure class="post__related-item"><a href="https://kppdi.github.io/membuat-tool-kompresi-file-pake-delphi-zlib/" class="c-card__image"><img src="https://kppdi.github.io/media/posts/50/responsive/plumbing-585658_1280-xs.jpg" loading="lazy" height="853" width="1280" alt=""></a><figcaption><h4 class="post__related-title"><a href="https://kppdi.github.io/membuat-tool-kompresi-file-pake-delphi-zlib/" class="inverse">Membuat Tool Kompresi File Pake Delphi + ZLIB</a></h4><time datetime="2008-10-10T16:49" class="u-small">10 October 2008</time></figcaption></figure><figure class="post__related-item"><a href="https://kppdi.github.io/koneksi-database-dengan-delphi-mysql-and-zeos/" class="c-card__image"><img src="https://kppdi.github.io/media/posts/46/responsive/slide-rule-317749_1280-xs.jpg" loading="lazy" height="1280" width="960" alt=""></a><figcaption><h4 class="post__related-title"><a href="https://kppdi.github.io/koneksi-database-dengan-delphi-mysql-and-zeos/" class="inverse">Koneksi Database Dengan Delphi, MySQL &amp; ZEOS</a></h4><time datetime="2008-09-14T16:15" class="u-small">14 September 2008</time></figcaption></figure></div></div></footer></article><div class="comments box"><h3 class="box__title">Comments</h3><div id="disqus_thread"></div><script>var disqus_config = function () {
                    this.page.url = 'https://kppdi.github.io/memproteksi-file-exe-dengan-password/';
            		this.page.identifier = '32';
                    this.page.title = ' Memproteksi File EXE Dengan Password';
                };
            
                var disqus_loaded = false;
            
                function publiiLoadDisqus() {
                    if(disqus_loaded) {
                        return false;
                    }
            
                    var top = document.getElementById('disqus_thread').offsetTop;
            
                    if (!disqus_loaded && (window.scrollY || window.pageYOffset) + window.innerHeight > top) {
                        disqus_loaded = true;
            
                        (function () {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://kppdi-group.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    }
                }
            
                publiiLoadDisqus();
            
                window.onscroll = function() {
                    publiiLoadDisqus();
                };</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div></main><div class="sidebar"><section class="box featured"><h3 class="box__title">Featured</h3><ul class="featured__container"><li class="featured__item"><a href="https://kppdi.github.io/parsing-json-ke-ttreeview/" class="featured__image-link"><img src="https://kppdi.github.io/media/posts/96/responsive/analytics-3088958_1280-xs.jpg" alt=""></a><div><a href="https://kppdi.github.io/parsing-json-ke-ttreeview/" class="featured__title">Parsing JSON Ke TTreeView</a> <time class="u-small" datetime="2020-08-02T17:33">2 August 2020</time></div></li><li class="featured__item"><a href="https://kppdi.github.io/screen-capture-menggunakan-delphi/" class="featured__image-link"><img src="https://kppdi.github.io/media/posts/4/responsive/winsnap_delphi_snapshot_screen_caputure-xs.png" alt=""></a><div><a href="https://kppdi.github.io/screen-capture-menggunakan-delphi/" class="featured__title">Screen Capture Menggunakan Delphi</a> <time class="u-small" datetime="2020-08-01T17:15">1 August 2020</time></div></li></ul></section><section class="box authors"><h3 class="box__title">Authors</h3><ul class="authors__cotainer"><li class="authors__item"><a href="https://kppdi.github.io/authors/grup-kppdi/" class="authors__image-link"><img src="https://kppdi.github.io/media/website/Logo-KPPDI.png" alt="Grup KPPDI"></a><div><a href="https://kppdi.github.io/authors/grup-kppdi/" class="authors__title">Grup KPPDI</a> <span class="u-small">Post: 35</span></div></li></ul></section><section class="box"><h3 class="box__title">Tags</h3><ul class="tags"><li><a href="https://kppdi.github.io/tags/adeisti/">Adeisti</a> <span class="u-small">(1)</span></li><li><a href="https://kppdi.github.io/tags/akuntansi/">Akuntansi</a> <span class="u-small">(1)</span></li><li><a href="https://kppdi.github.io/tags/angka/">Angka</a> <span class="u-small">(1)</span></li><li><a href="https://kppdi.github.io/tags/aplikasi/">aplikasi</a> <span class="u-small">(0)</span></li><li><a href="https://kppdi.github.io/tags/blob/">BLOB</a> <span class="u-small">(1)</span></li></ul></section></div><footer class="footer"><a class="footer__logo" href="https://kppdi.github.io/"><img src="https://kppdi.github.io/media/website/kppdi-headd.png" alt="Grup KPPDI"></a><nav><ul class="footer__nav"></ul></nav><div class="footer__copyright"><p>Powered by <a href="https://facebook.com/groups/kppdi" title="Grup KPPDI" target="_blank" rel="noopener">Grup KPPDI</a></p></div></footer></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script defer="defer" src="https://kppdi.github.io/assets/js/scripts.min.js?v=225cfb4a7e546edee710c4f1208e81e2"></script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script></body></html>